<!-- ========================================
templates/notes/help/notebook_guide.html - ノート作成ヘルプガイド
======================================== -->

{% extends 'base.html' %}

{% block title %}ノート作成ガイド | 株式分析記録{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- ヘッダー -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-white mb-4">📚 ノート作成ガイド</h1>
            <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                効果的な投資ノートの作り方をステップバイステップで解説します。
                初心者から上級者まで、より良い投資記録のためのヒントをお届けします。
            </p>
        </div>

        <!-- ナビゲーション -->
        <div class="flex flex-wrap justify-center gap-4 mb-12">
            <a href="#overview" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                📋 基本概念
            </a>
            <a href="#fields" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                📝 記入ガイド
            </a>
            <a href="#examples" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                💡 記入例
            </a>
            <a href="#tips" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors">
                🚀 活用のコツ
            </a>
            <a href="{% url 'notes:create' %}" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                ✏️ ノート作成
            </a>
        </div>

        <!-- 基本概念セクション -->
        <section id="overview" class="mb-16">
            <div class="bg-gray-800 rounded-xl p-8">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                    📋 <span class="ml-3">ノート作成の基本</span>
                </h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">🎯 ノートブックとは？</h3>
                            <p class="text-gray-300 mb-4">
                                ノートブックは「投資テーマ」単位で情報を管理するフォルダです。
                                単一銘柄ではなく、関連する複数の投資対象をまとめて記録できます。
                            </p>
                            <ul class="text-gray-300 space-y-2">
                                <li>• 「高配当株ウォッチ」</li>
                                <li>• 「米国成長株リサーチ」</li> 
                                <li>• 「2025年決算注目銘柄」</li>
                            </ul>
                        </div>
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">📝 エントリーとは？</h3>
                            <p class="text-gray-300 mb-4">
                                ノートブック内の個別記録です。1つの銘柄や1つのイベントに関する詳細な分析・記録を保存します。
                            </p>
                            <ul class="text-gray-300 space-y-2">
                                <li>• 決算分析エントリー</li>
                                <li>• ニュース・イベント記録</li>
                                <li>• 計算結果・バリュエーション</li>
                                <li>• 投資アイデア・メモ</li>
                            </ul>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">🏷️ タグ機能</h3>
                            <p class="text-gray-300 mb-4">
                                ノートブックやエントリーに付けるラベルです。横断的な検索や分類に使用します。
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="bg-red-600 text-white px-2 py-1 rounded text-sm">#高配当</span>
                                <span class="bg-blue-600 text-white px-2 py-1 rounded text-sm">#成長株</span>
                                <span class="bg-green-600 text-white px-2 py-1 rounded text-sm">#テクノロジー</span>
                                <span class="bg-purple-600 text-white px-2 py-1 rounded text-sm">#決算分析</span>
                            </div>
                        </div>
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">📂 サブノート</h3>
                            <p class="text-gray-300 mb-4">
                                ノートブック内を更に細分化するためのカテゴリです。情報の整理に便利です。
                            </p>
                            <ul class="text-gray-300 space-y-2">
                                <li>• 「日本株」「米国株」での地域分け</li>
                                <li>• 「候補」「保有中」「売却済」のステータス分け</li>
                                <li>• 「大型株」「中小型株」のサイズ分け</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- フィールドガイドセクション -->
        <section id="fields" class="mb-16">
            <div class="bg-gray-800 rounded-xl p-8">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                    📝 <span class="ml-3">各項目の記入ガイド</span>
                </h2>
                <div class="space-y-8">
                    {% for guide in field_guides %}
                    <div class="bg-gray-700 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-white mb-3">{{ guide.label }}</h3>
                        <p class="text-gray-300 mb-4">{{ guide.description }}</p>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-white mb-2">✅ 記入例</h4>
                                <ul class="space-y-2">
                                    {% for example in guide.examples %}
                                    <li class="bg-gray-600 p-3 rounded text-gray-200 text-sm">
                                        {{ example }}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-white mb-2">💡 コツ</h4>
                                <ul class="space-y-2">
                                    {% for tip in guide.tips %}
                                    <li class="text-gray-300 text-sm flex items-start">
                                        <span class="text-blue-400 mr-2">•</span>
                                        {{ tip }}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <!-- 記入例セクション -->
        <section id="examples" class="mb-16">
            <div class="bg-gray-800 rounded-xl p-8">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                    💡 <span class="ml-3">投資スタイル別記入例</span>
                </h2>
                <div class="space-y-8">
                    <div class="bg-gray-700 rounded-lg p-6" data-template="high_dividend">
                        <h3 class="text-2xl font-semibold text-white mb-4">🏆 高配当株投資</h3>
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <span class="text-blue-400 font-semibold">タイトル:</span>
                                    <p class="text-white">2025年 高配当株ポートフォリオ</p>
                                </div>
                                <div>
                                    <span class="text-blue-400 font-semibold">投資戦略:</span>
                                    <p class="text-gray-300">配当利回り3%以上かつ配当性向70%以下の財務健全な企業を選定。四半期決算での業績確認と配当政策の変更点を継続監視し、減配リスクの高い銘柄は早めに入れ替えを行う。</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <span class="text-green-400 font-semibold">選定基準:</span>
                                    <ul class="text-gray-300 mt-2">
                                        <li>• 配当利回り3%以上</li>
                                        <li>• 配当性向70%以下</li>
                                        <li>• 連続増配または安定配当</li>
                                        <li>• 自己資本比率40%以上</li>
                                    </ul>
                                </div>
                                <div>
                                    <span class="text-yellow-400 font-semibold">リスク要因:</span>
                                    <ul class="text-gray-300 mt-2">
                                        <li>• 金利上昇による株価下落</li>
                                        <li>• 減配・無配転落リスク</li>
                                        <li>• 景気後退による業績悪化</li>
                                    </ul>
                                </div>
                                <div>
                                    <span class="text-purple-400 font-semibold">推奨タグ:</span>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        <span class="bg-blue-600 text-white px-2 py-1 rounded text-sm">#高配当</span>
                                        <span class="bg-blue-600 text-white px-2 py-1 rounded text-sm">#配当株</span>
                                        <span class="bg-blue-600 text-white px-2 py-1 rounded text-sm">#長期投資</span>
                                        <span class="bg-blue-600 text-white px-2 py-1 rounded text-sm">#インカムゲイン</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-right">
                            <button onclick="applyTemplate('high_dividend')" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors font-semibold">
                                📋 この例を使用する
                            </button>
                        </div>
                    </div>

                    <div class="bg-gray-700 rounded-lg p-6" data-template="growth">
                        <h3 class="text-2xl font-semibold text-white mb-4">🚀 成長株投資</h3>
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <span class="text-blue-400 font-semibold">タイトル:</span>
                                    <p class="text-white">成長株研究ラボ 2025</p>
                                </div>
                                <div>
                                    <span class="text-blue-400 font-semibold">投資戦略:</span>
                                    <p class="text-gray-300">売上成長率年20%以上、ROE15%以上の高成長企業を選定。PEGレシオ1.5倍以下で購入し、四半期決算での成長持続性を確認。競合優位性の源泉と市場シェア拡大の可能性を重視する。</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <span class="text-green-400 font-semibold">選定基準:</span>
                                    <ul class="text-gray-300 mt-2">
                                        <li>• 売上成長率20%以上（3年平均）</li>
                                        <li>• ROE15%以上</li>
                                        <li>• PEGレシオ1.5倍以下</li>
                                        <li>• 競合優位性あり</li>
                                    </ul>
                                </div>
                                <div>
                                    <span class="text-yellow-400 font-semibold">リスク要因:</span>
                                    <ul class="text-gray-300 mt-2">
                                        <li>• 成長率鈍化リスク</li>
                                        <li>• 高バリュエーション調整</li>
                                        <li>• 競合激化による利益率低下</li>
                                        <li>• 技術革新の遅れ</li>
                                    </ul>
                                </div>
                                <div>
                                    <span class="text-purple-400 font-semibold">推奨タグ:</span>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        <span class="bg-green-600 text-white px-2 py-1 rounded text-sm">#成長株</span>
                                        <span class="bg-green-600 text-white px-2 py-1 rounded text-sm">#グロース投資</span>
                                        <span class="bg-green-600 text-white px-2 py-1 rounded text-sm">#テクノロジー</span>
                                        <span class="bg-green-600 text-white px-2 py-1 rounded text-sm">#イノベーション</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-right">
                            <button onclick="applyTemplate('growth')" 
                                    class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors font-semibold">
                                📋 この例を使用する
                            </button>
                        </div>
                    </div>

                    <div class="bg-gray-700 rounded-lg p-6" data-template="value">
                        <h3 class="text-2xl font-semibold text-white mb-4">💰 バリュー投資</h3>
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <span class="text-blue-400 font-semibold">タイトル:</span>
                                    <p class="text-white">割安株発掘プロジェクト</p>
                                </div>
                                <div>
                                    <span class="text-blue-400 font-semibold">投資戦略:</span>
                                    <p class="text-gray-300">PER15倍以下、PBR1.5倍以下の割安株の中から、ROE10%以上、営業利益率5%以上の収益性を持つ企業を選定。業績改善や事業転換の兆候を捉えて投資する。</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <span class="text-green-400 font-semibold">選定基準:</span>
                                    <ul class="text-gray-300 mt-2">
                                        <li>• PER15倍以下</li>
                                        <li>• PBR1.5倍以下</li>
                                        <li>• ROE10%以上</li>
                                        <li>• 営業利益率5%以上</li>
                                    </ul>
                                </div>
                                <div>
                                    <span class="text-yellow-400 font-semibold">リスク要因:</span>
                                    <ul class="text-gray-300 mt-2">
                                        <li>• バリュートラップ（割安な理由がある）</li>
                                        <li>• 業績回復の遅れ</li>
                                        <li>• 市場評価の長期低迷</li>
                                    </ul>
                                </div>
                                <div>
                                    <span class="text-purple-400 font-semibold">推奨タグ:</span>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        <span class="bg-yellow-600 text-white px-2 py-1 rounded text-sm">#割安株</span>
                                        <span class="bg-yellow-600 text-white px-2 py-1 rounded text-sm">#バリュー投資</span>
                                        <span class="bg-yellow-600 text-white px-2 py-1 rounded text-sm">#逆張り</span>
                                        <span class="bg-yellow-600 text-white px-2 py-1 rounded text-sm">#財務分析</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-right">
                            <button onclick="applyTemplate('value')" 
                                    class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg transition-colors font-semibold">
                                📋 この例を使用する
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 活用のコツセクション -->
        <section id="tips" class="mb-16">
            <div class="bg-gray-800 rounded-xl p-8">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                    🚀 <span class="ml-3">活用のコツ</span>
                </h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">🎯 効果的なノート運用</h3>
                            <ul class="text-gray-300 space-y-2">
                                <li>• 定期的な見直しスケジュールを決める</li>
                                <li>• 投資判断の根拠を必ず記録する</li>
                                <li>• 失敗例も含めて正直に記録する</li>
                                <li>• 数値基準は具体的に設定する</li>
                                <li>• タグを統一して検索しやすくする</li>
                            </ul>
                        </div>
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">📊 分析精度の向上</h3>
                            <ul class="text-gray-300 space-y-2">
                                <li>• 複数の指標を組み合わせて判断</li>
                                <li>• 業界比較・競合分析を含める</li>
                                <li>• マクロ経済環境も考慮する</li>
                                <li>• 過去の類似事例と比較する</li>
                                <li>• リスクシナリオも想定する</li>
                            </ul>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">⏰ 時間管理のコツ</h3>
                            <ul class="text-gray-300 space-y-2">
                                <li>• 記録は投資判断の直後に行う</li>
                                <li>• テンプレート化で効率を上げる</li>
                                <li>• 重要度によって記録レベルを変える</li>
                                <li>• 定期レビューの時間を確保する</li>
                                <li>• モバイルでも気軽に更新する</li>
                            </ul>
                        </div>
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-semibold text-white mb-3">🔍 振り返りの重要性</h3>
                            <ul class="text-gray-300 space-y-2">
                                <li>• 月次・四半期でパフォーマンス確認</li>
                                <li>• 成功・失敗の要因を分析</li>
                                <li>• 投資手法の改善点を見つける</li>
                                <li>• 市場環境の変化に対応する</li>
                                <li>• 長期的な投資戦略を見直す</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- アクションセクション -->
        <div class="text-center bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-8">
            <h2 class="text-3xl font-bold text-white mb-4">さあ、ノートを作成しましょう！</h2>
            <p class="text-blue-100 mb-6 max-w-2xl mx-auto">
                このガイドを参考に、あなただけの投資ノートを作成してください。
                効果的な記録が、より良い投資判断につながります。
            </p>
            <div class="flex flex-wrap justify-center gap-4">
                <a href="{% url 'notes:create' %}" 
                   class="bg-white text-blue-600 hover:bg-gray-100 px-8 py-3 rounded-lg font-semibold transition-colors">
                    ✏️ ノート作成を始める
                </a>
                <a href="{% url 'notes:list' %}" 
                   class="bg-blue-500 hover:bg-blue-400 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                    📚 既存のノートを見る
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// テンプレートデータの定義
const templateData = {
    'high_dividend': {
        title: '2025年 高配当株ポートフォリオ',
        subtitle: '配当利回り3%以上の安定銘柄で資産形成',
        description: 'インカムゲイン重視の長期投資戦略。配当の継続性と成長性を重視した銘柄選択を行います。',
        investment_strategy: '配当利回り3%以上かつ配当性向70%以下の財務健全な企業を選定。四半期決算での業績確認と配当政策の変更点を継続監視し、減配リスクの高い銘柄は早めに入れ替えを行う。目標年間配当利回り4%以上を目指し、月次で配当受取状況を確認する。',
        target_allocation: 'ポートフォリオの40%、月額投資額の50%',
        notebook_type: 'THEME',
        status: 'ACTIVE',
        key_criteria: [
            '配当利回り3%以上',
            '配当性向70%以下', 
            '連続増配または安定配当',
            '自己資本比率40%以上',
            '営業キャッシュフロー安定'
        ],
        risk_factors: [
            '金利上昇による株価下落',
            '減配・無配転落リスク',
            '景気後退による業績悪化',
            '配当課税制度の変更'
        ],
        suggested_tags: ['#高配当', '#配当株', '#長期投資', '#インカムゲイン', '#安定配当'],
        suggested_sub_notebooks: ['日本高配当株', '米国配当株', 'REITs', '配当貴族銘柄', '新規候補']
    },
    'growth': {
        title: '成長株研究ラボ 2025',
        subtitle: '次世代を担う成長企業の発掘と分析',
        description: '技術革新や市場拡大の恩恵を受ける企業への投資機会を追求します。将来の市場リーダーとなる可能性のある企業を早期発見し、中長期での大幅な株価上昇を狙います。',
        investment_strategy: '売上成長率年20%以上、ROE15%以上の高成長企業を選定。PEGレシオ1.5倍以下で購入し、四半期決算での成長持続性を確認。競合優位性の源泉（技術力、ブランド力、ネットワーク効果など）と市場シェア拡大の可能性を重視し、成長鈍化の兆候が見えた時点で売却を検討する。',
        target_allocation: 'ポートフォリオの30%、リスク資金の範囲内',
        notebook_type: 'THEME',
        status: 'ACTIVE',
        key_criteria: [
            '売上成長率20%以上（3年平均）',
            'ROE15%以上',
            'PEGレシオ1.5倍以下',
            '競合優位性あり',
            '市場拡大性（TAM成長）'
        ],
        risk_factors: [
            '成長率鈍化リスク',
            '高バリュエーション調整',
            '競合激化による利益率低下',
            '技術革新の遅れ',
            '規制強化リスク'
        ],
        suggested_tags: ['#成長株', '#グロース投資', '#テクノロジー', '#イノベーション', '#中長期投資'],
        suggested_sub_notebooks: ['AI・DX関連', 'バイオテック', 'クリーンエネルギー', '新興市場', 'IPO銘柄']
    },
    'value': {
        title: '割安株発掘プロジェクト',
        subtitle: '市場に見過ごされた優良企業を発見',
        description: '財務健全性が高いにも関わらず市場で過小評価されている企業を発掘し、本来の企業価値が認識されるまで保有する投資戦略です。',
        investment_strategy: 'PER15倍以下、PBR1.5倍以下の割安株の中から、ROE10%以上、営業利益率5%以上の収益性を持つ企業を選定。業績改善や事業転換の兆候、アクティビスト介入の可能性なども考慮し、カタリスト（株価上昇要因）が明確な銘柄に投資する。',
        target_allocation: 'ポートフォリオの25%、安全資金での運用',
        notebook_type: 'THEME', 
        status: 'ACTIVE',
        key_criteria: [
            'PER15倍以下',
            'PBR1.5倍以下',
            'ROE10%以上',
            '営業利益率5%以上',
            '明確なカタリスト存在'
        ],
        risk_factors: [
            'バリュートラップ（割安な理由がある）',
            '業績回復の遅れ',
            '市場評価の長期低迷',
            '事業構造の問題'
        ],
        suggested_tags: ['#割安株', '#バリュー投資', '#逆張り', '#財務分析', '#カタリスト'],
        suggested_sub_notebooks: ['日本バリュー株', '業績回復期待', 'スピンオフ銘柄', '再編候補', '隠れ優良株']
    }
};

// テンプレート適用機能
function applyTemplate(styleSlug) {
    const template = templateData[styleSlug];
    if (!template) {
        alert('テンプレートデータが見つかりません');
        return;
    }

    // ローカルストレージにテンプレートデータを保存
    localStorage.setItem('selectedTemplate', JSON.stringify(template));
    
    // 成功メッセージを表示
    showSuccessMessage('テンプレートを適用しました！ノート作成ページに移動します...');
    
    // 少し遅らせてからページ遷移
    setTimeout(() => {
        window.location.href = "{% url 'notes:create' %}?template=" + styleSlug;
    }, 1000);
}

// 成功メッセージ表示
function showSuccessMessage(message) {
    // 既存のメッセージがあれば削除
    const existingMessage = document.getElementById('success-message');
    if (existingMessage) {
        existingMessage.remove();
    }

    // 新しいメッセージを作成
    const messageDiv = document.createElement('div');
    messageDiv.id = 'success-message';
    messageDiv.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-pulse';
    messageDiv.innerHTML = `
        <div class="flex items-center space-x-2">
            <span>✅</span>
            <span>${message}</span>
        </div>
    `;

    document.body.appendChild(messageDiv);

    // 3秒後にメッセージを削除
    setTimeout(() => {
        messageDiv.remove();
    }, 3000);
}

// URLパラメータで直接テンプレートを指定する機能
function loadTemplateFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    const templateParam = urlParams.get('template');
    
    if (templateParam && templateData[templateParam]) {
        // 該当するテンプレートセクションをハイライト
        const templateSection = document.querySelector(`[data-template="${templateParam}"]`);
        if (templateSection) {
            templateSection.scrollIntoView({ behavior: 'smooth' });
            templateSection.style.border = '2px solid #3b82f6';
            templateSection.style.background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1))';
        }
    }
}

// スムーススクロール
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// ページロード時の処理
document.addEventListener('DOMContentLoaded', function() {
    loadTemplateFromUrl();
});
</script>
{% endblock %}